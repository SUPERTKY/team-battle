<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>透明な下パネル＋キャラ湧き</title>
  <style>
    html, body { margin:0; height:100%; }
    .stage{
      position:relative; width:100vw; height:100vh; overflow:hidden;
      background: url("assets/sougen.png") center/cover no-repeat;
    }

    /* 完全透明＆クリック不可の下パネル（高さ：全体の9分の4 ≒ 44.44%） */
    .bottom-rect{
      position:absolute; left:0; right:0; bottom:0;
      height:44.44vh; background: transparent;
      pointer-events: none;       /* ← パネルはクリックを拾わない */
      z-index: 10;
    }

    /* 役者（キャラクター）を載せる層。層自体はクリック不可だが、中の画像は可 */
    .actors-layer{
      position:absolute; left:0; right:0; bottom:0; height:44.44vh;
      pointer-events: none;       /* 層は拾わない */
      z-index: 20;
    }

    /* キャラクター画像はクリック可（個別に） */
    .actor{
      position:absolute; width:96px; height:auto;
      pointer-events: auto;       /* ← 画像はクリック可能 */
      user-select: none; -webkit-user-drag: none;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.35));
      transition: transform 120ms ease;
    }
    .actor:active{ transform: scale(0.96); }

    /* UIボタン */
    .controls{
      position:absolute; top:12px; right:12px; z-index:30;
      display:flex; gap:8px;
    }
    .btn{
      padding:10px 14px; border-radius:10px; border:1px solid rgba(0,0,0,0.15);
      background:#ffffffcc; backdrop-filter: blur(6px);
      font:600 14px/1 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      cursor:pointer;
    }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }
    .cap{
      position:absolute; bottom:46vh; left:50%; transform:translateX(-50%);
      background:#00000080; color:#fff; padding:6px 10px; border-radius:8px;
      font:600 12px/1 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      z-index:25; pointer-events:none;
    }
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <!-- 透明・非クリックのパネル（目に見えないガイド） -->
    <div class="bottom-rect" id="panel"></div>

    <!-- パネル上に重ねるキャラクター用の層 -->
    <div class="actors-layer" id="actorsLayer"></div>

    <!-- ちょいメッセージ -->
    <div class="cap">下エリア（9分の4）は透明ですが、この上にキャラが湧きます</div>

    <!-- コントロール -->
    <div class="controls">
      <button class="btn" id="spawnBtn">Spawn（湧かす）</button>
      <button class="btn" id="clearBtn">Clear</button>
    </div>
  </div>

  <script>
    // 設定：キャラ画像のパス（差し替えてOK）
    const CHARACTER_SRC = "assets/suraimu1frame.png"; // 例：assets/char1.png に置き換え可
    const MAX_ACTORS = 6;
    const ACTOR_WIDTH = 96;  // CSS と合わせる
    const ACTOR_HEIGHT = 96; // 大体の高さ（縦横比により変わるので余裕を持って確保）

    const actorsLayer = document.getElementById("actorsLayer");
    const spawnBtn = document.getElementById("spawnBtn");
    const clearBtn = document.getElementById("clearBtn");

    function countActors(){
      return actorsLayer.querySelectorAll(".actor").length;
    }

    function updateButtons(){
      spawnBtn.disabled = countActors() >= MAX_ACTORS;
    }

    function rand(min, max){ return Math.random() * (max - min) + min; }

    function spawnActor(){
      if (countActors() >= MAX_ACTORS) return;

      const rect = actorsLayer.getBoundingClientRect();

      // はみ出さないようにランダム位置を計算
      const maxX = Math.max(0, rect.width - ACTOR_WIDTH);
      const maxY = Math.max(0, rect.height - ACTOR_HEIGHT);
      const x = rand(0, maxX);
      const y = rand(0, maxY);

      const img = document.createElement("img");
      img.src = CHARACTER_SRC;
      img.className = "actor";
      img.style.left = `${x}px`;
      img.style.top  = `${y}px`;
      img.alt = "character";

      // クリックで軽いアクション（例：消える）
      img.addEventListener("click", (e)=>{
        e.stopPropagation();
        img.remove();
        updateButtons();
      });

      actorsLayer.appendChild(img);
      updateButtons();
    }

    function clearActors(){
      actorsLayer.querySelectorAll(".actor").forEach(el => el.remove());
      updateButtons();
    }

    spawnBtn.addEventListener("click", spawnActor);
    clearBtn.addEventListener("click", clearActors);

    // 初期状態
    updateButtons();

    // リサイズ時も安全側にボタン状態など維持（配置はそのまま）
    window.addEventListener("resize", ()=>{ updateButtons(); });
  </script>
</body>
</html>
